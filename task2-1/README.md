# 排名法淘汰分析 - 完整项目说明

## 项目概览

本项目完成了对《与星共舞》第3-27季排名法与百分比法淘汰结果的全面对比分析，包括数据处理、统计分析、可视化展示和详细解读。

---

## 📁 项目文件结构

```
task2-1/
├── rank_method_elimination.py              # 核心分析代码
├── rank_method_visualization.py            # 可视化与统计检验代码
├── 排名法淘汰分析说明.md                    # 代码逻辑详细说明
├── 排名法可视化结果解读.md                  # 图表详细解读文档
├── fan_vote_estimates_entropy_smooth_100.csv  # 输入: 观众投票估计
├── rank_vs_percent_elimination_2.csv       # 输出: 每周对比结果
└── visualization_results/                   # 可视化输出目录
    ├── consistency_by_season.png           # 图1: 一致性趋势
    ├── percentage_scatter.png              # 图2: 百分比散点图
    ├── rank_heatmap.png                    # 图3: 排名热力图
    └── 可视化与统计分析报告.md              # 自动生成的简报
```

---

## 📊 文件详细说明

### 1. 核心代码文件

#### `rank_method_elimination.py`
**功能**: 排名法淘汰模拟与对比分析

**主要功能**:
- 加载评委数据和观众投票估计
- 对每周应用排名法计算淘汰名单
- 与百分比法实际淘汰结果对比
- 分析哪种方法更偏向观众意见
- 输出详细对比CSV文件

**关键函数**:
- `apply_rank_method_one_week()`: 单周排名法淘汰
- `run_rank_method_all_seasons()`: 全季度批量分析
- `analyze_which_favors_audience()`: 观众倾向性分析

**输出**: `rank_vs_percent_elimination_2.csv`

**运行方式**:
```bash
python rank_method_elimination.py
```

#### `rank_method_visualization.py`
**功能**: 可视化分析与统计检验

**主要功能**:
1. 生成三张高质量可视化图表
2. 执行两种卡方检验
3. 计算效应量（Cramér's V）
4. 自动生成分析报告

**可视化内容**:
- 图1: 一致比例随季数变化（折线图+柱状图）
- 图2: 差异周选手百分比分布（散点图）
- 图3: 评委-观众排名热力图（4个子图）

**统计检验**:
- 卡方检验1: 基于随机期望（p < 0.001，极显著）
- 卡方检验2: 按时期分组（p = 0.12，不显著）
- 效应量: Cramér's V = 0.14（小效应）

**运行方式**:
```bash
python rank_method_visualization.py
```

---

### 2. 数据文件

#### 输入文件

**`fan_vote_estimates_entropy_smooth_100.csv`**
- 来源: 问题一的观众投票估计模型
- 内容: 每季每周每位选手的估计观众投票百分比
- 字段: season, week, celebrity_name, fan_vote_percent
- 行数: 1998行（覆盖第3-27季所有参赛选手）

**`../../2026_MCM_Problem_C_Processed_Data.xlsx`**
- 来源: 官方数据
- 内容: 评委百分比、实际淘汰结果
- 用途: 提供评委数据和百分比法的基准结果

#### 输出文件

**`rank_vs_percent_elimination_2.csv`**
- 内容: 每周淘汰对比详细结果
- 字段:
  - `season`: 季数
  - `week`: 周数
  - `n_contestants`: 参赛选手数
  - `n_eliminated`: 淘汰人数
  - `percent_eliminated`: 百分比法淘汰名单（逗号分隔）
  - `rank_eliminated`: 排名法淘汰名单（逗号分隔）
  - `same_result`: 是否一致（True/False）
- 行数: 248行（第3-27季所有周）
- 用途: 详细记录，可用于进一步分析

---

### 3. 文档文件

#### `排名法淘汰分析说明.md`
**定位**: 代码逻辑说明文档

**内容结构**:
1. 代码目标与背景
2. 数据来源
3. 核心算法逻辑（排名规则、核心函数）
4. 差异分析方法
5. 统计指标说明
6. 使用方法
7. 结果解读
8. 技术细节
9. 注意事项与局限性
10. 扩展与改进方向

**适用读者**: 
- 需要理解代码实现的开发者
- 需要验证算法正确性的审查者
- 希望复现或改进模型的研究者

**篇幅**: 421行，约15000字

#### `排名法可视化结果解读.md`
**定位**: 图表详细解读文档

**内容结构**:
1. 分析概览
2. 图表详细解读
   - 图1: 一致比例趋势图（折线+柱状）
   - 图2: 百分比散点图
   - 图3: 排名热力图
3. 统计检验解释
   - 卡方检验1: 基于随机期望
   - 卡方检验2: 按时期分组
   - 效应量分析
4. 关键发现与洞察
5. 使用指南

**特色**:
- 每张图表都有详细的元素解读
- 提供具体案例说明如何解读
- 包含实际应用建议
- 附录提供统计概念速查

**适用读者**:
- 论文撰写者（需要引用和解释图表）
- 数据分析师（需要理解可视化含义）
- 决策者（需要从图表中获取洞察）

**篇幅**: 约800行，约25000字

#### `visualization_results/可视化与统计分析报告.md`
**定位**: 自动生成的简要报告

**内容**:
- 基本统计摘要
- 可视化结果概述
- 统计检验结果
- 结论与讨论

**特点**: 
- 简洁明了
- 数据驱动
- 自动生成（每次运行更新）

**适用读者**: 
- 需要快速了解结果的读者
- 项目汇报材料

---

### 4. 可视化图表

#### `consistency_by_season.png`
**图表类型**: 双子图（折线图 + 堆叠柱状图）

**上子图**: 一致比例趋势
- 蓝色实线: 每季一致比例
- 紫色虚线: 二次趋势线
- 橙色虚线: 平均值（61.60%）

**下子图**: 周数分布
- 绿色: 一致周数
- 红色: 差异周数

**关键发现**:
- 平均一致比例 61.60%
- 最高 100%（第26季）
- 最低 25%（第20季）
- 标准差 17.92%

**用途**: 
- 展示时间趋势
- 识别异常季度
- 支持"一致性随时间波动"的论点

#### `percentage_scatter.png`
**图表类型**: 散点图

**坐标轴**:
- X轴: 评委百分比
- Y轴: 观众百分比
- 对角线: 评委=观众参考线

**颜色编码**:
- 🔴 红色X: 两种方法都淘汰
- 🟠 橙色▲: 仅百分比法淘汰
- 🔵 蓝色▼: 仅排名法淘汰
- 🟢 绿色●: 两种方法都保留

**关键发现**:
- 橙色点多在对角线上方（观众>评委）
- 说明排名法保护了"观众喜爱但评委不看好"的选手
- 支持"排名法更偏向观众"的结论

**用途**:
- 展示差异周的数据分布
- 分析两种方法的差异模式
- 支持观众倾向性分析

#### `rank_heatmap.png`
**图表类型**: 2×2 热力图矩阵

**四个子图**:
1. 左上: 两种方法都淘汰（红色系）
2. 右上: 仅百分比法淘汰（橙色系）
3. 左下: 仅排名法淘汰（蓝色系）
4. 右下: 两种方法都保留（绿色系）

**每个子图**:
- 10×10 热力图
- 横轴: 观众排名（1-10）
- 纵轴: 评委排名（1-10）
- 颜色深度: 选手数量
- 对角线: 评委=观众排名

**关键发现**:
- 子图2（仅百分比法淘汰）热点在对角线上方
- 子图3（仅排名法淘汰）热点分布显示综合排名和效应
- 支持排名法机制分析

**用途**:
- 展示排名组合与淘汰结果的关系
- 理解排名法的淘汰边界
- 验证"综合排名和"规则的影响

---

## 📈 核心结果总结

### 数据统计

| 指标 | 数值 |
|------|------|
| 总周数 | 248 |
| 有人淘汰周数 | 205 |
| 无人淘汰周数 | 43 |
| 一致周数 | 125 |
| 差异周数 | 80 |
| **一致比例** | **60.98%** |

### 统计检验

| 检验 | 结果 | 结论 |
|------|------|------|
| 卡方检验1（随机期望） | χ²=437.84, p<0.001 | 极显著，两种方法高度相关 |
| 卡方检验2（时期分组） | χ²=4.30, p=0.12 | 不显著，时期差异不明显 |
| Cramér's V | 0.1448 | 小效应量 |

### 关键发现

1. **整体一致性较高**: 60.98%的周数淘汰结果一致，远高于随机期望（12.55%）

2. **存在系统性差异**: 卡方检验p<0.001，说明39.02%的差异不是随机波动

3. **时间趋势不显著**: 虽然晚期一致性下降（50%），但统计上不显著

4. **排名法更偏向观众**: 在差异周中，排名法倾向保护高观众人气选手

---

## 🚀 快速开始

### 环境配置
```bash
# 安装依赖
pip install pandas numpy matplotlib seaborn scipy openpyxl
```

### 运行分析
```bash
# 1. 生成淘汰对比数据
python rank_method_elimination.py

# 2. 生成可视化和统计分析
python rank_method_visualization.py
```

### 查看结果
- **对比数据**: `rank_vs_percent_elimination_2.csv`
- **可视化图表**: `visualization_results/` 目录
- **分析报告**: `visualization_results/可视化与统计分析报告.md`

---

## 📖 文档阅读建议

### 快速了解（5分钟）
1. 阅读本文档的"核心结果总结"部分
2. 查看三张可视化图表
3. 阅读`可视化与统计分析报告.md`

### 深入理解（30分钟）
1. 阅读`排名法淘汰分析说明.md`了解算法逻辑
2. 阅读`排名法可视化结果解读.md`的"图表详细解读"部分
3. 查看`rank_vs_percent_elimination_2.csv`了解具体数据

### 全面掌握（2小时）
1. 完整阅读所有文档
2. 运行代码并观察输出
3. 修改参数进行敏感性分析
4. 尝试扩展分析（如加权排名法）

---

## 🔧 扩展分析建议

### 1. 敏感性分析
- 改变排名方法（`method='min'` → `'average'`, `'dense'`）
- 改变同分优先级（评委优先 → 观众优先）
- 使用不同的观众估计数据（不同平滑参数）

### 2. 加权分析
实现加权排名法：
```python
综合排名 = α × 评委排名 + (1-α) × 观众排名
```
分析不同α值（0.3, 0.5, 0.7）下的一致性变化

### 3. 子群分析
- 按选手类型分组（歌手、演员、运动员等）
- 按季度特征分组（参赛人数、淘汰规则等）
- 分析不同子群中两种方法的表现差异

### 4. 预测建模
- 建立模型预测哪些周会出现差异
- 特征：选手数、百分比分布、排名分布等
- 方法：逻辑回归、随机森林等

---

## ⚠️ 注意事项

### 数据质量
- 观众投票数据是**估计值**，存在误差
- 估计误差会影响排名法的淘汰结果
- 建议进行Bootstrap置信区间分析

### 统计假设
- 卡方检验假设样本独立
- 实际上同一季的周可能相关
- 可考虑使用混合效应模型控制季度效应

### 解释局限
- 一致性高不代表排名法"更好"
- 差异存在不代表排名法"有问题"
- 应结合实际场景和目标选择方法

---

## 📞 技术支持

### 常见问题

**Q1: 为什么要排除无人淘汰周？**
A: 无人淘汰时两种方法都不淘汰，"一致"是平凡的，会虚高一致比例。

**Q2: 卡方检验1的p值为什么这么小？**
A: 因为观测一致性（60.98%）远高于随机期望（12.55%），说明两种方法高度相关。

**Q3: 为什么时期差异不显著？**
A: 样本量可能不足，或真实差异确实不大。可以通过增加季度数据来验证。

**Q4: 如何判断哪种方法更好？**
A: 没有绝对的"更好"，取决于节目目标：
- 保护观众喜爱的选手 → 排名法
- 奖励全面优秀的选手 → 百分比法

---

## 📚 相关文档

### 本项目文档
- `排名法淘汰分析说明.md`: 代码逻辑详解
- `排名法可视化结果解读.md`: 图表详细解读
- `可视化与统计分析报告.md`: 结果简报

### 相关项目文档
- `../task1-1/观众投票估计模型使用说明.md`: 观众数据来源
- `../task1-1/GPU_加速使用指南.md`: 计算优化指南
- `../项目进展记录.md`: 整体项目进展

### 外部参考
- 2026 MCM Problem C 题目描述
- Problem C Appendix（排名法规则说明）

---

## 📝 版本历史

### v1.0 (2026-01-31)
- ✅ 完成排名法淘汰模拟
- ✅ 完成与百分比法对比分析
- ✅ 完成三张可视化图表
- ✅ 完成两种卡方检验
- ✅ 完成详细文档编写

---

## 🎓 致谢

感谢 2026 MCM 组委会提供的优质数据集，以及问题一团队提供的观众投票估计结果。

---

**项目状态**: ✅ 已完成  
**最后更新**: 2026-01-31  
**文档版本**: v1.0
