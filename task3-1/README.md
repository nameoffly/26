# Task 3-1: 名人属性与比赛结果关系分析

## 概述

本模块对应 MCM Problem C 第三问：分析名人特征（年龄、行业、地区）和专业舞伴对比赛结果的影响，以及这些因素对评委评分和粉丝投票的影响是否一致。

**核心问题**：
> "Use the data including your fan vote estimates to develop a model that analyzes the impact of various pro dancers as well as characteristics for the celebrities available in the data (age, industry, etc). How much do such things impact how well a celebrity will do in the competition? Do they impact judges scores and fan votes in the same way?"

---

## 文件说明

| 文件 | 说明 |
|------|------|
| `merge_data.py` | 数据合并脚本（合并粉丝投票预测与选手信息） |
| `add_industry_placement.py` | 添加行业和名次字段的脚本 |
| `analyze_celebrity_impact.py` | **主分析脚本**：统计检验、回归分析、可视化 |
| `combined_contestant_info.csv` | 综合选手信息数据（周级别，2777行） |
| `outputs/` | 统计分析结果输出目录 |
| `figures/` | 可视化图表输出目录 |

---

## 数据说明

### 输入数据

| 数据源 | 内容 | 行数 |
|--------|------|------|
| `Data_4.xlsx` | 选手基本信息（行业、年龄、名次等） | 421行（选手级别） |
| `combined_contestant_info.csv` | 周级别数据（含粉丝投票预测） | 2777行 |

### 数据字段

`combined_contestant_info.csv` 包含以下列：

| 列名 | 数据类型 | 说明 |
|------|----------|------|
| 赛季 | int | 赛季编号 (1-34) |
| 周数 | int | 比赛周数 |
| 人名 | string | 选手名字 |
| 伴侣名 | string | 舞伴名字 |
| 地区 | string | 选手家乡州/地区（非美国选手填"others"） |
| 国家 | string | 选手国家 |
| 年龄 | int | 参赛时年龄 |
| **行业** | string | 名人行业类别（26种） |
| **最终名次** | int | 最终排名（1=冠军） |
| **比赛结果** | string | 淘汰周/名次描述 |
| 评委评分百分比 | float | 评委评分占比（小数形式） |
| 粉丝投票百分比 | float | 粉丝投票占比（模型预测值） |
| 总百分比 | float | 评委 + 粉丝百分比之和 |

### 数据统计

- **选手数**: 421人（跨34个赛季）
- **周级别记录**: 2777行
- **年龄范围**: 14-82岁，平均38.8岁
- **行业分布**: Actor/Actress(30.4%), Athlete(22.6%), TV Personality(15.9%), Singer/Rapper(14.5%)

---

## 使用的统计方法

### 1. 卡方检验 (Chi-Square Test)

**目的**：检验行业与获奖（Top 3）是否独立

**数学原理**：

卡方检验用于检验两个分类变量之间是否存在关联。原假设 H₀ 为两变量独立。

**卡方统计量**：
$$\chi^2 = \sum_{i=1}^{r}\sum_{j=1}^{c} \frac{(O_{ij} - E_{ij})^2}{E_{ij}}$$

其中：
- $O_{ij}$ = 观测频数（实际观测到的行业i获奖状态j的人数）
- $E_{ij}$ = 期望频数（假设独立时的理论人数）
- $E_{ij} = \frac{(\text{行}i\text{总数}) \times (\text{列}j\text{总数})}{\text{总样本量}}$
- $r$ = 行业类别数
- $c$ = 获奖状态数（2：获奖/未获奖）

**自由度**：$df = (r-1)(c-1)$

**判断标准**：
- 若 $p < 0.05$，拒绝 H₀，认为行业与获奖显著相关
- 若 $p \geq 0.05$，不拒绝 H₀，认为行业与获奖无显著关系

---

### 2. Pearson 相关系数

**目的**：量化年龄与名次/评分之间的线性关系强度

**数学原理**：

Pearson 相关系数衡量两个连续变量之间的线性相关程度。

**计算公式**：
$$r = \frac{\sum_{i=1}^{n}(x_i - \bar{x})(y_i - \bar{y})}{\sqrt{\sum_{i=1}^{n}(x_i - \bar{x})^2} \cdot \sqrt{\sum_{i=1}^{n}(y_i - \bar{y})^2}}$$

其中：
- $x_i$ = 第i个选手的年龄
- $y_i$ = 第i个选手的最终名次
- $\bar{x}$ = 年龄均值
- $\bar{y}$ = 名次均值
- $n$ = 样本量

**取值范围**：$r \in [-1, 1]$
- $r > 0$：正相关（年龄越大，名次数值越大，即排名越差）
- $r < 0$：负相关
- $|r| \approx 0$：无线性关系
- $|r| > 0.3$：中等相关
- $|r| > 0.5$：强相关

**显著性检验**：
$$t = \frac{r\sqrt{n-2}}{\sqrt{1-r^2}}, \quad df = n-2$$

---

### 3. 单因素方差分析 (One-Way ANOVA)

**目的**：检验不同行业的平均名次是否存在显著差异

**数学原理**：

ANOVA 通过比较组间方差与组内方差来判断各组均值是否相等。

**模型**：
$$Y_{ij} = \mu + \alpha_i + \epsilon_{ij}$$

其中：
- $Y_{ij}$ = 第i个行业第j个选手的名次
- $\mu$ = 总体均值
- $\alpha_i$ = 第i个行业的效应（与总体均值的偏差）
- $\epsilon_{ij}$ = 随机误差，假设 $\epsilon_{ij} \sim N(0, \sigma^2)$

**F 统计量**：
$$F = \frac{MSB}{MSW} = \frac{SSB/(k-1)}{SSW/(n-k)}$$

其中：
- $SSB$ = 组间平方和 = $\sum_{i=1}^{k} n_i(\bar{Y}_i - \bar{Y})^2$
- $SSW$ = 组内平方和 = $\sum_{i=1}^{k}\sum_{j=1}^{n_i}(Y_{ij} - \bar{Y}_i)^2$
- $k$ = 行业类别数
- $n$ = 总样本量
- $\bar{Y}_i$ = 第i个行业的平均名次
- $\bar{Y}$ = 总体平均名次

**判断标准**：
- 若 $p < 0.05$，拒绝 H₀，认为至少有两个行业的平均名次存在显著差异

---

### 4. 普通最小二乘回归 (OLS Regression)

**目的**：建立名次/评分与多个自变量之间的定量关系

**数学原理**：

OLS 回归通过最小化残差平方和来估计回归系数。

**模型**：
$$Y = \beta_0 + \beta_1 X_1 + \beta_2 X_2 + ... + \beta_p X_p + \epsilon$$

对于本分析：
$$\text{最终名次} = \beta_0 + \beta_1 \cdot \text{年龄} + \sum_{j=2}^{k} \beta_j \cdot I(\text{行业}=j) + \epsilon$$

其中：
- $\beta_0$ = 截距（基准行业、年龄为0时的预期名次）
- $\beta_1$ = 年龄系数（年龄每增加1岁，名次的预期变化）
- $\beta_j$ = 第j个行业相对于基准行业的效应
- $I(\cdot)$ = 指示函数（哑变量编码）
- $\epsilon$ = 随机误差

**参数估计**（矩阵形式）：
$$\hat{\boldsymbol{\beta}} = (\mathbf{X}^T\mathbf{X})^{-1}\mathbf{X}^T\mathbf{Y}$$

**模型评估指标**：

1. **决定系数 R²**：
$$R^2 = 1 - \frac{SS_{res}}{SS_{tot}} = 1 - \frac{\sum(Y_i - \hat{Y}_i)^2}{\sum(Y_i - \bar{Y})^2}$$
   - 表示模型解释的方差比例
   - $R^2 \in [0, 1]$，越接近1说明模型拟合越好

2. **系数显著性**：
$$t = \frac{\hat{\beta}_j}{SE(\hat{\beta}_j)}, \quad p\text{-value} = P(|T| > |t|)$$
   - 若 $p < 0.05$，该系数显著不为0

---

### 5. Logistic 回归

**目的**：预测选手是否获奖（Top 3）的概率

**数学原理**：

Logistic 回归用于二分类问题，通过 logit 变换将线性预测值映射到 [0,1] 概率区间。

**模型**：
$$\log\left(\frac{P(Y=1)}{1-P(Y=1)}\right) = \beta_0 + \beta_1 X_1 + ... + \beta_p X_p$$

等价于：
$$P(Y=1) = \frac{1}{1 + e^{-(\beta_0 + \beta_1 X_1 + ... + \beta_p X_p)}}$$

其中：
- $P(Y=1)$ = 获奖概率
- $\frac{P(Y=1)}{1-P(Y=1)}$ = 优势比 (Odds)
- $\beta_j$ = 第j个变量的对数优势比系数

**系数解释**：
- $e^{\beta_j}$ = 优势比 (Odds Ratio)
- 例如：若年龄系数 $\beta_1 = -0.05$，则 $e^{-0.05} \approx 0.95$
- 意味着年龄每增加1岁，获奖的优势比下降约5%

---

## 建模过程

### 步骤 1：数据预处理

```
原始数据 → 合并行业/名次字段 → 选手级别汇总 → 特征工程
```

1. **数据合并**：将 `Data_4.xlsx` 中的行业、名次字段通过 (赛季, 人名) 关联到周级别数据
2. **选手级别汇总**：计算每位选手的平均粉丝投票、平均评委评分、存活周数
3. **派生变量**：
   - `是否获奖` = 最终名次 ≤ 3
   - `年龄组` = 分箱（<25, 25-35, 35-45, 45-55, 55+）

### 步骤 2：描述性统计

对各行业计算：
- 平均名次、名次标准差
- 获奖人数、获奖率
- 平均年龄
- 平均粉丝投票、平均评委评分

### 步骤 3：假设检验

| 检验 | 原假设 H₀ | 备择假设 H₁ |
|------|-----------|-------------|
| 卡方检验 | 行业与获奖独立 | 行业与获奖相关 |
| Pearson相关 | 年龄与名次无关 (ρ=0) | 年龄与名次相关 (ρ≠0) |
| ANOVA | 各行业平均名次相同 | 至少两个行业不同 |
| Pearson相关 | 年龄与粉丝投票无关 (ρ=0) | 年龄与粉丝投票相关 (ρ≠0) |
| Pearson相关 | 年龄与评委评分无关 (ρ=0) | 年龄与评委评分相关 (ρ≠0) |
| 卡方检验 | 美国vs非美国与获奖独立 | 美国vs非美国与获奖相关 |
| 卡方检验 | 地区与获奖独立（美国） | 地区与获奖相关 |

### 步骤 4：回归建模

建立4个回归模型：

| 模型 | 因变量 | 自变量 | 方法 |
|------|--------|--------|------|
| 模型1 | 最终名次 | 年龄 + 行业 | OLS |
| 模型2 | 是否获奖 | 年龄 + 行业 | Logistic |
| 模型3 | 平均评委评分 | 年龄 + 行业 | OLS |
| 模型4 | 平均粉丝投票 | 年龄 + 行业 | OLS |

### 步骤 5：舞伴分析

计算每位舞伴的：
- 平均名次（越小越好）
- 获奖次数、获奖率
- 参赛次数
- 平均粉丝投票、平均评委评分

筛选条件：参赛次数 ≥ 3（确保统计稳定性）

### 步骤 6：可视化

生成6张图表展示分析结果。

---

## 输出文件说明

### 统计结果表格 (`outputs/`)

#### 1. `descriptive_stats.csv` - 描述性统计

| 列名 | 说明 |
|------|------|
| 行业 | 行业类别 |
| 平均名次 | 该行业选手的平均最终名次 |
| 名次标准差 | 名次的离散程度 |
| 人数 | 该行业的选手数量 |
| 获奖人数 | 进入Top 3的人数 |
| 获奖率 | 获奖人数/总人数 |
| 平均年龄 | 该行业选手的平均年龄 |
| 平均粉丝投票 | 该行业选手的平均粉丝投票百分比 |
| 平均评委评分 | 该行业选手的平均评委评分百分比 |

**如何解读**：
- 按"平均名次"升序排列，排在前面的行业表现更好
- "获奖率"直观反映该行业进入Top 3的概率
- 注意"人数"列，样本量小的行业结果可能不稳定

#### 2. `hypothesis_tests.csv` - 假设检验结果

| 列名 | 说明 |
|------|------|
| 检验 | 检验方法名称 |
| 假设 | 原假设 H₀ 的描述 |
| 统计量 | 检验统计量的值（χ²、r、F等） |
| p值 | 显著性水平 |
| 自由度 | 检验的自由度 |
| 结论 | "拒绝H0"或"不拒绝H0" |

**如何解读**：
- **p值 < 0.05**：结果显著，拒绝原假设
- **p值 ≥ 0.05**：结果不显著，不能拒绝原假设
- 例如：年龄与名次的Pearson相关 r=0.43, p<0.001，说明年龄与名次显著正相关

#### 3. `regression_results.txt` - 回归分析详细结果

包含完整的回归输出，包括：
- 模型摘要（R²、F统计量）
- 各变量的系数、标准误、t值、p值
- 置信区间

**如何解读系数**：
- **年龄系数 = 0.12**：年龄每增加1岁，预期名次增加0.12（即排名变差）
- **行业系数**：相对于基准行业（Actor/Actress）的效应
  - 正系数：该行业比基准行业表现差
  - 负系数：该行业比基准行业表现好

#### 4. `partner_ranking.csv` - 舞伴排名

| 列名 | 说明 |
|------|------|
| 伴侣名 | 舞伴姓名 |
| 平均名次 | 该舞伴搭档选手的平均最终名次 |
| 获奖次数 | 带领选手进入Top 3的次数 |
| 获奖率 | 获奖次数/参赛次数 |
| 参赛次数 | 该舞伴参加的赛季数 |
| 平均粉丝投票 | 该舞伴搭档选手的平均粉丝投票 |
| 平均评委评分 | 该舞伴搭档选手的平均评委评分 |

**如何解读**：
- 按"平均名次"升序排列，排在前面的舞伴"带飞"能力更强
- 结合"参赛次数"看，次数多的舞伴结果更可靠
- "获奖率"直观反映舞伴带领选手获奖的概率

#### 5. `country_stats.csv` - 国家统计

| 列名 | 说明 |
|------|------|
| 国家 | 国家/地区名称 |
| 平均名次 | 该国家选手的平均最终名次 |
| 人数 | 该国家的选手数量 |
| 获奖人数 | 进入Top 3的人数 |
| 获奖率 | 获奖人数/总人数 |

#### 6. `region_stats.csv` - 美国各州统计

| 列名 | 说明 |
|------|------|
| 地区 | 美国州名 |
| 平均名次 | 该州选手的平均最终名次 |
| 人数 | 该州的选手数量 |
| 获奖人数 | 进入Top 3的人数 |
| 获奖率 | 获奖人数/总人数 |

---

### 可视化图表 (`figures/`)

#### 1. `industry_placement_boxplot.png` - 行业名次分布箱线图

**内容**：各行业选手最终名次的分布情况

**如何解读**：
- **箱体**：中间50%数据的范围（Q1到Q3）
- **中线**：中位数
- **须线**：数据的合理范围
- **离群点**：异常值
- 箱体位置越低（名次数值越小），该行业表现越好

#### 2. `age_placement_scatter.png` - 年龄-名次散点图

**内容**：年龄与最终名次的关系，带回归线

**如何解读**：
- 每个点代表一位选手
- 红色回归线显示整体趋势
- 标题中的 r 值表示相关系数，p 值表示显著性
- 正斜率说明年龄越大，名次越差

#### 3. `partner_ranking_bar.png` - 舞伴排名条形图

**内容**：Top 20 舞伴的平均名次排名

**如何解读**：
- 条形越短（平均名次越小），舞伴"带飞"能力越强
- 绿色条形表示平均名次 ≤ 5 的顶级舞伴

#### 4. `industry_winrate_bar.png` - 行业获奖率条形图

**内容**：各行业进入Top 3的概率

**如何解读**：
- 条形越长，该行业获奖率越高
- 红色虚线表示平均获奖率
- 金色条形表示获奖率 ≥ 30% 的行业

#### 5. `age_analysis.png` - 年龄分析组合图

**内容**：
- 左图：获奖者vs未获奖者的年龄分布直方图
- 右图：各年龄组的获奖率条形图

**如何解读**：
- 左图：比较两组的年龄分布差异
- 右图：直观看出哪个年龄段获奖率最高

#### 6. `judge_vs_fan_age.png` - 评委vs粉丝年龄影响对比

**内容**：
- 左图：年龄与评委评分的关系
- 右图：年龄与粉丝投票的关系

**如何解读**：
- 比较两图的斜率（r值）
- 斜率更陡（|r|更大）说明该因素影响更大
- 可以判断评委和粉丝对年龄的"偏好"是否一致

#### 7. `country_analysis.png` - 美国 vs 非美国分析

**内容**：
- 左图：美国与非美国选手人数和获奖人数对比
- 右图：美国与非美国获奖率对比

**如何解读**：
- 左图：蓝色表示总人数，金色表示获奖人数
- 右图：条形高度表示获奖率
- 红色虚线表示平均获奖率

#### 8. `region_analysis.png` - 美国各州分析

**内容**：各州选手的获奖率（人数>=5）

**如何解读**：
- 条形越长，该州获奖率越高
- 金色条形表示获奖率 ≥ 30% 的州
- 红色虚线表示平均获奖率

---

## 结果分析

### 1. 年龄影响（最显著的发现）

| 指标 | 相关系数 r | p值 | 结论 |
|------|-----------|-----|------|
| 年龄 vs 名次 | +0.43 | <0.001 | **年龄越大，名次越差** |
| 年龄 vs 评委评分 | -0.43 | <0.001 | 年龄越大，评委评分越低 |
| 年龄 vs 粉丝投票 | -0.34 | <0.001 | 年龄越大，粉丝投票越低 |

**关键发现**：
- 年龄是影响比赛结果的最显著因素
- 年龄对评委评分的影响（|r|=0.43）大于对粉丝投票的影响（|r|=0.34）
- **结论**：评委比粉丝更"歧视"年龄大的选手

**回归系数解释**：
- 年龄系数 = 0.12：年龄每增加1岁，预期名次增加0.12
- 即：年龄相差10岁的两位选手，年长者预期名次差1.2名

### 2. 行业影响（不显著）

| 检验 | 统计量 | p值 | 结论 |
|------|--------|-----|------|
| 卡方检验 | χ²=34.75 | 0.093 | 行业与获奖无显著关系 |
| ANOVA | F=2.18 | 0.056 | 各行业名次无显著差异 |

**关键发现**：
- 在统计学意义上，行业对比赛结果没有显著影响
- 但描述性统计显示一些趋势：
  - 运动员（Athlete）平均名次6.26，获奖率28.4%
  - 演员（Actor/Actress）平均名次6.55，获奖率24.2%
- 这些差异可能是随机波动，而非系统性差异

### 3. 舞伴影响（显著）

**Top 5 "带飞"舞伴**：

| 排名 | 舞伴 | 平均名次 | 获奖率 | 参赛次数 |
|------|------|----------|--------|----------|
| 1 | Derek Hough | 2.94 | 52.9% | 17 |
| 2 | Julianne Hough | 4.20 | 40.0% | 5 |
| 3 | Daniella Karagach | 4.60 | 60.0% | 5 |
| 4 | Mark Ballas | 5.19 | 47.6% | 21 |
| 5 | Valentin Chmerkovskiy | 5.26 | 47.4% | 19 |

**关键发现**：
- Derek Hough 是最强舞伴，平均名次仅2.94，获奖率超过50%
- 舞伴之间的差异很大：最佳舞伴平均名次2.94 vs 最差舞伴10.43
- 好的舞伴可以显著提升选手的比赛成绩

### 4. 评委 vs 粉丝差异

| 因素 | 对评委评分的影响 | 对粉丝投票的影响 | 差异 |
|------|------------------|------------------|------|
| 年龄 | -0.00122/岁 | -0.00183/岁 | 粉丝对年龄更敏感 |

**关键发现**：
- 年龄对粉丝投票的负面影响（-0.00183）大于对评委评分的影响（-0.00122）
- 这与相关系数的结果看似矛盾，但实际上：
  - 相关系数衡量的是线性关系强度
  - 回归系数衡量的是边际效应
- 综合来看，年龄对评委和粉丝的影响方向一致（都是负面），但程度略有差异

### 5. 国家影响：美国 vs 非美国（不显著）

| 检验 | 统计量 | p值 | 结论 |
|------|--------|-----|------|
| 卡方检验（美国vs非美国） | χ²=0.00 | 1.000 | 美国vs非美国与获奖无显著关系 |
| 卡方检验（美国各州） | χ²=14.22 | 0.819 | 地区与获奖无显著关系 |

**美国 vs 非美国统计**：

| 类别 | 人数 | 获奖率 | 平均名次 |
|------|------|--------|----------|
| US | 365 | 24.1% | 6.84 |
| Non-US | 56 | 25.0% | 6.68 |

**美国各州统计（人数>=10）**：

| 州 | 人数 | 获奖率 | 平均名次 |
|----|------|--------|----------|
| Pennsylvania | 13 | 38.5% | 5.23 |
| Georgia | 15 | 33.3% | 5.40 |
| Illinois | 15 | 26.7% | 7.00 |
| Florida | 20 | 25.0% | 6.15 |
| Texas | 25 | 24.0% | 6.44 |
| California | 72 | 19.4% | 7.69 |
| New York | 47 | 17.0% | 7.68 |
| Ohio | 13 | 7.7% | 9.00 |

**关键发现**：
- 美国选手与非美国选手在获奖率上没有显著差异
- 绝大多数选手来自美国（365/421 = 86.7%）
- 美国各州之间存在一些差异，但统计上不显著
- Pennsylvania 和 Georgia 的获奖率较高，Ohio 较低，但样本量有限

### 6. 综合结论

1. **年龄是最重要的因素**：年轻选手在评委评分和粉丝投票上都有优势
2. **行业影响不显著**：不同行业的选手在比赛中没有系统性优势
3. **国家/地区影响不显著**：来自不同国家或美国不同州的选手没有系统性差异
4. **舞伴选择很重要**：好的舞伴可以显著提升比赛成绩
5. **评委和粉丝偏好一致**：两者都倾向于给年轻选手更高的分数

---

## 使用方法

```bash
# 步骤1：添加行业和名次字段（如果数据未更新）
python task3-1/add_industry_placement.py

# 步骤2：运行分析脚本
python task3-1/analyze_celebrity_impact.py

# 输出文件位置
# - task3-1/outputs/*.csv  (统计结果)
# - task3-1/figures/*.png  (可视化图表)
```

---

## 注意事项

1. **样本量问题**：部分行业样本量很小（如Conservationist仅1人），其统计结果不可靠
2. **因果推断限制**：本分析为相关性分析，不能直接推断因果关系
3. **数据质量**：粉丝投票百分比为模型预测值，存在一定误差
4. **舞伴效应混淆**：舞伴的"带飞"能力可能与其搭档的选手质量有关（选择偏差）

---

## 参考文献

- Pearson, K. (1895). Notes on regression and inheritance in the case of two parents.
- Fisher, R. A. (1925). Statistical methods for research workers.
- Hosmer, D. W., & Lemeshow, S. (2000). Applied logistic regression.
