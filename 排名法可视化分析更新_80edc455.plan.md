---
name: 排名法可视化分析更新
overview: 根据新增的决赛排名数据，更新可视化代码，将淘汰结果和决赛排名结果整合到前三个图中，并新增决赛专项分析图表。
todos:
  - id: update-data-source
    content: 更新数据源为 Data_4.xlsx
    status: completed
  - id: update-consistency-plot
    content: 优化图1：整合淘汰一致性和决赛排名准确性趋势
    status: in_progress
  - id: update-scatter-plot
    content: 优化图2：整合淘汰和决赛选手的百分比散点图
    status: pending
  - id: update-heatmap
    content: 优化图3：整合淘汰和决赛选手的排名热力图
    status: pending
  - id: plot-final-accuracy
    content: 新增图4：决赛排名准确性对比柱状图
    status: pending
  - id: plot-final-trend
    content: 新增图5：决赛准确性随季度变化趋势图
    status: pending
  - id: plot-error-analysis
    content: 新增图6：排名法预测失败案例分析
    status: pending
  - id: plot-bobby-bones
    content: 新增图7：Bobby Bones 案例专题分析
    status: pending
  - id: update-report
    content: 更新分析报告，添加决赛排名分析内容
    status: pending
isProject: false
---

# 排名法可视化分析更新计划

## 一、整合后的综合可视化（前3个图优化）

修改 [rank_method_visualization.py](task2-1/rank_method_visualization.py) 中的前三个图，**同时统计淘汰结果和决赛排名结果**：

### 图1: 综合准确性趋势图（优化）

- **原内容**：仅展示淘汰结果一致性随季数变化
- **新增内容**：叠加决赛排名准确性（百分比法、排名法）
- **图表设计**：
  - 子图1：淘汰一致比例趋势（折线图）+ 决赛排名准确性标记
  - 子图2：每季综合统计（堆叠柱状图：一致周数 + 决赛是否正确）

### 图2: 综合百分比散点图（优化）

- **原内容**：仅展示差异周选手的评委-观众百分比分布
- **新增内容**：加入决赛选手数据点，用不同标记区分
- **图表设计**：2个子图
  - 子图1：淘汰分析（两种方法都淘汰、仅百分比法淘汰、仅排名法淘汰、都保留）
  - 子图2：决赛分析（排名法正确、排名法错误的决赛选手分布）

### 图3: 综合排名热力图（优化）

- **原内容**：仅展示差异周选手的评委排名 vs 观众排名分布
- **新增内容**：加入决赛选手的排名分布
- **图表设计**：6个子图
  - 上排4图：淘汰相关（两种都淘汰、仅百分比淘汰、仅排名淘汰、都保留）
  - 下排2图：决赛相关（排名法预测正确 vs 排名法预测错误的选手分布）

---

## 二、新增决赛专项可视化（4个新图）

### 图4: 决赛排名准确性对比柱状图

- **内容**：两种方法的"完全正确"、"冠军正确"、"前两名正确"对比
- **数据源**：`is_final==True` 的行，统计 `percent_exact_match` vs `rank_exact_match`
- **图表类型**：分组柱状图

### 图5: 决赛准确性随季度变化趋势图

- **内容**：每季决赛两种方法的排名是否正确
- **数据源**：`percent_exact_match` 和 `rank_exact_match` 按季度展示
- **图表类型**：双折线图/标记图（标记每季正确/错误）

### 图6: 排名法预测失败案例分析

- **内容**：分析排名法预测错误的9季决赛的特征
- **展示**：冠军的评委分 vs 观众分散点图，标注正确/错误预测
- **图表类型**：散点图 + 标注

### 图7: Bobby Bones 案例专题分析

- **内容**：第27季争议冠军 Bobby Bones 的分析
- **展示**：决赛4位选手的评委分、观众分、两种方法排名对比
- **图表类型**：组合图（柱状图 + 排名标注）

---

## 三、数据处理要点

从 CSV 文件中提取数据：

```python
# 筛选决赛周
final_df = df[df['is_final'] == True]

# 筛选有淘汰的周
elim_df = df[df['n_eliminated'] > 0]

# 解析排名字符串（格式：Name1>Name2>Name3）
def parse_ranking(ranking_str):
    if pd.isna(ranking_str) or ranking_str == '':
        return []
    return ranking_str.split('>')
```

整合统计时需要关联的字段：

- 淘汰一致性：`same_result` 字段
- 决赛准确性：`percent_exact_match`、`rank_exact_match`、`percent_top1_correct`、`rank_top1_correct` 字段

---

## 四、代码修改位置

修改 [rank_method_visualization.py](task2-1/rank_method_visualization.py)：

1. 更新 `plot_consistency_by_season()` - 整合决赛准确性
2. 更新 `plot_percentage_scatter()` - 添加决赛选手数据
3. 更新 `plot_rank_heatmap()` - 添加决赛排名分布
4. 新增 `plot_final_accuracy_comparison()` - 图4
5. 新增 `plot_final_accuracy_trend()` - 图5
6. 新增 `plot_final_error_analysis()` - 图6
7. 新增 `plot_bobby_bones_analysis()` - 图7
8. 更新 `generate_summary_report()` - 添加决赛分析内容
9. 更新数据源为 `Data_4.xlsx`

---

## 五、预期输出文件

```
visualization_results/
├── consistency_by_season.png      # 优化：整合决赛准确性
├── percentage_scatter.png         # 优化：添加决赛选手
├── rank_heatmap.png               # 优化：添加决赛分布
├── final_accuracy_comparison.png  # 新增：图4
├── final_accuracy_trend.png       # 新增：图5
├── final_error_analysis.png       # 新增：图6
├── bobby_bones_analysis.png       # 新增：图7
└── 可视化与统计分析报告.md         # 更新
```

