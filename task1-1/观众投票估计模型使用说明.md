# 观众投票估计模型使用说明

## 一、项目概述

本项目针对 Dancing with the Stars (DWTS) 第3-27季的数据，开发了**三种数学模型**来估计每位选手每周的观众投票百分比。由于实际的观众投票数据是保密的，我们基于已知的评委评分和淘汰结果进行反向推断。

| 模型                    | 核心思想      | 特点       |
| ----------------------- | ------------- | ---------- |
| 最小方差                | 投票均匀分布  | 保守估计   |
| 平滑性                  | 人气稳定变化  | 跨周连续   |
| **最大熵+平滑性** | 均匀+连续联合 | 避免极端解 |

---

## 二、代码文件说明

### 2.1 `fan_vote_estimation.py` - 最小方差正则化版本

#### 核心思想

在满足约束条件的前提下，假设**观众投票在选手之间尽可能均匀分布**。

#### 数学模型

**目标函数：**

$$
\min \sum_{i=1}^{n} v_i^2
$$

**约束条件：**

1. 归一化：$\sum_{i=1}^{n} v_i = 1$
2. 非负性：$v_i \geq 0$
3. 淘汰约束：$v_s - v_e \geq j_e - j_s + \epsilon$（幸存者总分 > 淘汰者总分）

#### 适用场景

- 缺乏外部人气信息时的保守估计
- 假设没有特别突出的"人气王"

#### 输出文件

- `fan_vote_estimates.csv`
- `fan_vote_estimates_with_confidence.csv`（包含置信度）

---

### 2.2 `fan_vote_estimation_smooth.py` - 平滑性正则化版本

#### 核心思想

在满足约束条件的前提下，假设**选手的粉丝基础在相邻周之间变化尽可能小**。

#### 数学模型

**第一步：求解可行区间**

对每位选手每周，求解其观众投票百分比的可行区间 $[v_{min}, v_{max}]$：

- $v_{min} = \min v_i$ subject to 所有约束
- $v_{max} = \max v_i$ subject to 所有约束

**第二步：平滑性优化**

**目标函数：**

$$
\min \sum_{\text{选手}i} \sum_{t=2}^{T_i} (v_{i,t} - v_{i,t-1})^2
$$

其中 $T_i$ 是选手 $i$ 参赛的周数。

**约束条件：**

1. 每周的归一化和非负约束
2. 每周的淘汰约束
3. 每位选手每周的值在可行区间内

#### 适用场景

- 认为选手有稳定的粉丝群体
- 更适合解释"争议性"选手（如 Bobby Bones）

#### 输出文件

- `fan_vote_estimates_smooth.csv`

---

### 2.3 `fan_vote_estimation_entropy_smooth.py` - 最大熵+平滑性联合正则化版本

#### 核心思想

将**最大熵原则**和**平滑性原则**结合成统一目标函数，同时实现：

1. **最大熵**：让每周的投票分布尽可能均匀，避免极端解
2. **平滑性**：让同一选手的投票在相邻周之间变化尽可能小

#### 数学模型

**目标函数：**

$$
\max \sum_{t} H_t(v) - \lambda \sum_{t,i} (v_{i,t} - v_{i,t-1})^2
$$

其中熵 $H_t(v) = -\sum_{i} v_{i,t} \log v_{i,t}$

等价于最小化：

$$
\min \sum_{t} \sum_{i} v_{i,t} \log v_{i,t} + \lambda \sum_{t,i} (v_{i,t} - v_{i,t-1})^2
$$

**约束条件：**

1. 归一化：$\sum_{i} v_{i,t} = 1$（每周）
2. 非负性：$v_{i,t} \geq 0$
3. 淘汰约束：$T_e < T_s$（淘汰者总分低于幸存者）

#### 参数说明

| 参数              | 默认值 | 说明                              |
| ----------------- | ------ | --------------------------------- |
| `epsilon`       | 0.001  | 严格不等式的小量                  |
| `lambda_smooth` | 10.0   | 平滑性权重 (λ)，更强调时间连续性 |

**λ 参数的作用：**

| λ 值    | 效果                                                     |
| -------- | -------------------------------------------------------- |
| λ 大    | 更强调**时间连续性**，同一选手的投票在相邻周变化小 |
| λ 小    | 更强调**每周均匀性**（最大熵），每周分布更均匀     |
| λ = 0   | 退化为纯最大熵模型，每周独立优化                         |
| λ → ∞ | 退化为纯平滑性模型，强制时间连续                         |

#### 适用场景

- 需要平衡"均匀性"和"连续性"
- 避免每周独立求解导致的人气剧烈抖动
- 避免纯平滑性模型可能产生的极端解

#### 输出文件

- `fan_vote_estimates_entropy_smooth.csv`

---

## 三、结果文件字段说明

### 3.1 通用字段

| 字段名               | 类型  | 说明                                        |
| -------------------- | ----- | ------------------------------------------- |
| `season`           | int   | 季度（3-27）                                |
| `week`             | int   | 周数                                        |
| `celebrity_name`   | str   | 选手名字                                    |
| `judge_percent`    | float | 评委评分百分比（已知）                      |
| `fan_vote_percent` | float | 观众投票百分比（估计值）                    |
| `total_percent`    | float | 总百分比 = judge_percent + fan_vote_percent |
| `eliminated`       | bool  | 本周是否被淘汰                              |
| `solve_status`     | str   | 优化求解状态                                |

### 3.2 最小方差版本特有字段

| 字段名         | 类型  | 说明                                  |
| -------------- | ----- | ------------------------------------- |
| `is_finale`  | bool  | 是否为决赛周                          |
| `confidence` | float | 置信度（0-1），基于淘汰约束的松紧程度 |

### 3.3 平滑性版本特有字段

| 字段名             | 类型  | 说明                     |
| ------------------ | ----- | ------------------------ |
| `fan_vote_min`   | float | 观众投票百分比的可行下界 |
| `fan_vote_max`   | float | 观众投票百分比的可行上界 |
| `interval_width` | float | 可行区间宽度 = max - min |

### 3.4 最大熵+平滑性版本特有字段

| 字段名           | 类型  | 说明                                             |
| ---------------- | ----- | ------------------------------------------------ |
| `smoothness`   | float | 该选手的平滑度指标（相邻周变化的平方和的平均值） |
| `n_weeks`      | int   | 该选手参赛的总周数                               |
| `week_entropy` | float | 该周所有选手投票分布的熵值                       |

**字段解读：**

- **`smoothness`**：值越小表示该选手的投票在各周之间越稳定。计算公式：

  $$
  \text{smoothness} = \frac{1}{T-1} \sum_{t=2}^{T} (v_t - v_{t-1})^2
  $$
- **`week_entropy`**：值越大表示该周的投票分布越均匀。最大值为 $\ln(n)$，其中 $n$ 是该周的选手数。计算公式：

  $$
  H = -\sum_{i} v_i \log v_i
  $$
- **`n_weeks`**：用于判断 `smoothness` 是否有意义（首周选手的 smoothness 为 0）

---

## 四、结果分析

### 4.1 验证指标

三种方法的验证结果：

| 指标                 | 最小方差 | 平滑性 | 最大熵+平滑性 (λ=10) |
| -------------------- | -------- | ------ | --------------------- |
| 处理季度数           | 25       | 25     | 25                    |
| 处理周数             | 248      | 248    | 248                   |
| 选手-周估计数        | 1997     | 1997   | 1997                  |
| **约束满足率** | 100%     | 100%   | 100%                  |
| 平均平滑度           | 0.0016   | 0.0016 | **0.0118**      |
| 平均熵               | -        | -      | 2.16                  |
| 平均边际余量         | -        | -      | 1.83%                 |

约束满足率100%意味着：所有淘汰者的总百分比都低于所有幸存者，与实际淘汰结果一致。

### 4.2 争议性选手对比分析

#### Bobby Bones (第27季冠军)

Bobby Bones 是一个典型的"争议性"选手：评委评分一直很低，但最终夺冠。

| 周               | 评委%  | 最小方差 | 平滑性 | **熵+平滑性 (λ=10)** |
| ---------------- | ------ | -------- | ------ | --------------------------- |
| 1                | 7.84%  | 7.69%    | 22.50% | **7.89%**             |
| 2                | 7.21%  | 8.33%    | 22.50% | **8.53%**             |
| 3                | 8.49%  | 9.09%    | 22.50% | **9.39%**             |
| 4                | 8.62%  | 10.18%   | 22.50% | **10.47%**            |
| 5                | 9.46%  | 11.11%   | 22.77% | **11.68%**            |
| 6                | 9.61%  | 11.11%   | 23.04% | **12.38%**            |
| 7                | 12.18% | 12.50%   | 23.44% | **14.60%**            |
| 8                | 13.98% | 19.04%   | 24.10% | **19.04%**            |
| 9                | 23.38% | 25.00%   | 25.00% | **25.00%**            |
| **平均**   | -      | 12.76%   | 23.43% | **13.22%**            |
| **标准差** | -      | 5.74%    | 1.05%  | **5.59%**             |

**三种方法的解读：**

- **最小方差方法**：估计 Bobby 的粉丝投票从低（7.69%）逐渐增加到高（25%），每周分布均匀。
- **平滑性方法**：估计 Bobby 从一开始就有稳定的高粉丝投票（~22-25%），波动极小。
- **最大熵+平滑性方法**：估计 Bobby 的投票从7.7%逐渐增长到25.4%，同时保持平滑过渡，兼顾了均匀性和连续性。

**哪种更合理？**

- 如果认为 Bobby 有稳定的核心粉丝群 → 平滑性方法
- 如果认为 Bobby 的人气是逐渐积累的 → 最大熵+平滑性方法
- 如果想要保守估计 → 最小方差方法

#### Bristol Palin (第11季季军)

另一个争议性选手：评委评分最低12次，但仍获得第3名。

| 周               | 评委%  | 最小方差 | 平滑性 | **熵+平滑性 (λ=10)** |
| ---------------- | ------ | -------- | ------ | --------------------------- |
| 1                | 7.93%  | 8.33%    | 31.25% | **8.62%**             |
| 2                | 9.95%  | 10.00%   | 31.25% | **9.40%**             |
| 3                | 8.60%  | 9.09%    | 31.27% | **10.44%**            |
| 4                | 8.94%  | 10.00%   | 31.29% | **11.78%**            |
| 5                | 9.89%  | 10.00%   | 31.31% | **13.52%**            |
| 6                | 13.53% | 12.50%   | 31.33% | **15.80%**            |
| 7                | 15.59% | 14.29%   | 31.62% | **18.54%**            |
| 8                | 17.74% | 20.00%   | 32.06% | **22.39%**            |
| 9                | 23.25% | 25.00%   | 33.02% | **27.37%**            |
| 10               | 30.92% | 33.33%   | 33.33% | **33.33%**            |
| **平均**   | -      | 15.25%   | 31.77% | **17.12%**            |
| **标准差** | -      | 8.08%    | 0.81%  | **8.28%**             |

**解读：**

- **平滑性方法**：估计 Bristol Palin 始终拥有约31-33%的高观众投票
- **最大熵+平滑性方法**：估计她的投票从8.35%逐渐增长到33.33%，更符合"人气逐渐积累"的直觉

### 4.3 三种方法的选择建议

| 场景                 | 推荐方法            | 理由           |
| -------------------- | ------------------- | -------------- |
| 保守估计，无先验信息 | 最小方差            | 假设最均匀分布 |
| 分析选手的固有人气   | 平滑性              | 假设人气稳定   |
| 研究粉丝投票策略变化 | 最大熵+平滑性       | 兼顾均匀和连续 |
| 避免极端解           | 最大熵+平滑性       | 熵约束防止极端 |
| 预测未来比赛结果     | 平滑性 或 熵+平滑性 | 考虑时间连续性 |
| 每周独立分析         | 最小方差            | 每周单独优化   |

---

## 五、确定性分析（问题一第二问）

问题一要求回答：估计出的观众投票总数（或等价地，观众投票百分比）有多少确定性？不同选手/周是否具有一致的确定性？本部分采用两种互补方式量化。

### 5.1 方法一：可行域区间法

**思路**：对每位选手每周 $(s,i,t)$，在满足所有约束（归一化、非负、淘汰）下，求观众投票百分比 $v_{s,i,t}$ 的可行范围 $[v_{s,i,t}^{min}, v_{s,i,t}^{max}]$，用区间宽度作为不确定性度量：

$$
w_{s,i,t} = v_{s,i,t}^{max} - v_{s,i,t}^{min}
$$

**计算方式**：

- $v_{s,i,t}^{min}$：在约束 $\sum_i v_i=1$、$v_i\ge 0$、以及所有淘汰约束 $T_e < T_s$ 下，对**该选手该周**的观众投票百分比做**最小化**（线性规划），得到的最小值。
- $v_{s,i,t}^{max}$：在相同约束下，对**该选手该周**的观众投票百分比做**最大化**（线性规划），得到的最大值。
- 区间宽度 $w_{s,i,t} = v_{max} - v_{min}$ 越大，表示在满足淘汰结果的前提下，该选手该周的观众投票估计可变动范围越大，即**不确定性越大**；宽度越小则估计越确定。

**数据来源**：直接使用估计结果 CSV 中的列 `fan_vote_min`、`fan_vote_max`、`interval_width`（λ=100 的熵+平滑性结果中已包含上述线性规划求得的可行区间）。

**实现与输出**：脚本 `fan_vote_certainty_analysis.py` 读取 `fan_vote_estimates_entropy_smooth_100.csv`，按“是否被淘汰”分组，对每组的 `interval_width` 做汇总统计，写入 `certainty_method1_interval_summary.csv`；并按“本周是否有淘汰”对周级平均区间宽度做统计并打印。

### 5.2 方法二：扰动-重建（Bootstrap）法

**思路**：考虑评委打分的主观波动，对评委百分比加噪声后重新求解模型，用多次重解得到的观众投票估计的散布程度衡量确定性。

1. **扰动**：第 $b$ 次重采样中，对**该周该选手**的评委百分比加噪声：$J'_{s,i,t} = J_{s,i,t} + \eta_{s,i,t}$，其中 $\eta_{s,i,t} \sim N(0, \sigma^2)$（默认 $\sigma=0.01$），并对 $J'$ 做裁剪保证落在 $[10^{-6}, 1]$，得到扰动后的该周评委数据。
2. **重建**：用同一套最大熵+平滑性模型（λ=100），在**该季该周**的扰动后评委数据下重新求解整季的观众投票，得到该次样本下该选手该周的观众投票百分比 $v_{s,i,t}^{(b)}$。
3. **度量**：对每位选手每周，在 $B$ 次（默认 15 次）Bootstrap 样本上计算：
   - 样本均值：$\bar{v}_{s,i,t} = \frac{1}{B}\sum_b v_{s,i,t}^{(b)}$
   - 样本方差：$\mathrm{Var}(v_{s,i,t}) = \frac{1}{B-1}\sum_b (v_{s,i,t}^{(b)} - \bar{v}_{s,i,t})^2$
   - 样本标准差：$\mathrm{Std}(v_{s,i,t}) = \sqrt{\mathrm{Var}(v_{s,i,t})}$
   - 95% 分位数区间：$\mathrm{CI}_{95\%}(v_{s,i,t}) = [Q_{2.5\%}, Q_{97.5\%}]$，即 $v^{(b)}$ 的 2.5% 分位数与 97.5% 分位数。

**实现与输出**：同一脚本在指定 Excel 与 CSV 路径下，对每季每周评委数据加噪、重解、收集 $v^{(b)}$，按 `(season, week, celebrity_name)` 聚合后与基础估计表合并，输出 `certainty_method2_bootstrap.csv`。两种方法的合并表为 `certainty_combined.csv`。

### 5.3 结果文件字段说明

#### 5.3.1 `certainty_method1_interval_summary.csv`（方法一汇总表）

本文件为**按“是否被淘汰”分组的汇总表**，每一行对应一组（`eliminated=True` 或 `False`），不包含选手/周级别的明细。

| 字段名         | 类型  | 含义                           | 计算方式                                                                      |
| -------------- | ----- | ------------------------------ | ----------------------------------------------------------------------------- |
| `eliminated` | bool  | 该组是否为“本周被淘汰”的选手 | 分组键：来自基础估计表的 `eliminated` 列                                    |
| `count`      | int   | 该组内选手-周记录数            | 对 `interval_width` 做 `count` 聚合                                       |
| `mean_width` | float | 该组内可行区间宽度的平均值     | $\frac{1}{n}\sum_{k\in\text{组}} w_k$，其中 $w_k = v_{max,k} - v_{min,k}$ |
| `std_width`  | float | 该组内可行区间宽度的标准差     | $\sqrt{\frac{1}{n-1}\sum_{k\in\text{组}}(w_k - \overline{w})^2}$            |
| `min_width`  | float | 该组内可行区间宽度的最小值     | $\min_{k\in\text{组}} w_k$                                                  |
| `max_width`  | float | 该组内可行区间宽度的最大值     | $\max_{k\in\text{组}} w_k$                                                  |

**解读**：`mean_width` 越大，表示该组整体上“在满足淘汰结果的前提下，观众投票可变动范围”越大，即估计的**确定性越低**。通常被淘汰者一组的 `mean_width` 远小于幸存者一组，因为淘汰约束会收紧被淘汰者的可行上界。

#### 5.3.2 `certainty_method2_bootstrap.csv`（方法二 Bootstrap 明细表）

本文件为**选手-周级别明细表**：先保留基础估计表（来自 `fan_vote_estimates_entropy_smooth_100.csv`）的全部列，再按 `(season, week, celebrity_name)` 合并方法二计算出的 Bootstrap 统计量。

**来自基础估计表的列**（含义见前文“结果文件字段说明”）
`season`, `week`, `celebrity_name`, `judge_percent`, `fan_vote_percent`, `total_percent`, `fan_vote_min`, `fan_vote_max`, `interval_width`, `smoothness`, `n_weeks`, `week_entropy`, `eliminated`, `solve_status`。

**方法二新增列**（均由 Bootstrap 重解得到的 $v^{(1)},\ldots,v^{(B)}$ 计算）：

| 字段名                | 类型  | 含义                                 | 计算方式                                                                                   |
| --------------------- | ----- | ------------------------------------ | ------------------------------------------------------------------------------------------ |
| `fan_vote_mean_b`   | float | Bootstrap 样本下观众投票百分比的均值 | $\bar{v} = \frac{1}{B}\sum_{b=1}^{B} v^{(b)}$                                            |
| `fan_vote_var_b`    | float | Bootstrap 样本方差                   | $\mathrm{Var}(v) = \frac{1}{B-1}\sum_{b=1}^{B}(v^{(b)} - \bar{v})^2$                     |
| `fan_vote_std_b`    | float | Bootstrap 样本标准差                 | $\mathrm{Std}(v) = \sqrt{\mathrm{Var}(v)}$                                               |
| `fan_vote_ci_lower` | float | 95% 置信区间下界                     | $v^{(b)}$ 的 **2.5% 分位数** $Q_{2.5\%}$                                         |
| `fan_vote_ci_upper` | float | 95% 置信区间上界                     | $v^{(b)}$ 的 **97.5% 分位数** $Q_{97.5\%}$                                       |
| `n_bootstrap`       | int   | 有效 Bootstrap 样本数                | 该 (season, week, celebrity_name) 下实际参与聚合的$v^{(b)}$ 个数（通常等于设定的 $B$） |

**解读**：

- **方差/标准差**：`fan_vote_var_b`、`fan_vote_std_b` 越大，表示在评委打分扰动下，该选手该周的观众投票估计波动越大，**确定性越低**。
- **95% 置信区间**：`[fan_vote_ci_lower, fan_vote_ci_upper]` 表示在重复“加噪-重解”下，约 95% 的估计值落在此区间；区间越宽，不确定性越大。可与方法一的 `[fan_vote_min, fan_vote_max]`（可行域）对比：Bootstrap 区间反映的是“模型+数据扰动”下的不确定性，可行域反映的是“仅满足约束”下的理论范围。

### 5.4 结果分析

**方法一（可行域区间）**

- 按“是否被淘汰”汇总（基于现有 λ=100 估计结果）示例：
  - **被淘汰者**：区间宽度均值约 **0.15**，标准差约 0.055；约束更紧，可行域更窄，估计更确定。
  - **幸存者**：区间宽度均值约 **0.98**，标准差约 0.03；可行域大，估计不确定性更高。
- 按“本周是否有淘汰”汇总：**无淘汰周**的平均区间宽度为 1（所有选手在该周无淘汰约束收紧）；**有淘汰周**的平均区间宽度小于 1。
- **结论**：确定性并非对所有选手/周一致——越受淘汰约束“收紧”的选手（如当周被淘汰者），可行区间越窄、估计越确定；幸存者及无淘汰周则不确定性更大。

**方法二（Bootstrap）**

- 可得到每位选手每周的估计方差和 95% 置信区间；方差或区间宽度越大，表示在评委打分扰动下估计越不稳定、确定性越低。
- 可用于进一步验证“越接近淘汰边界的选手/周，不确定性越大”等假设（例如对比被淘汰者与幸存者的平均方差或平均区间宽度）。



B 是 Bootstrap 的重复次数（重采样/扰动-重建的次数）。

## B 在做什么？

方法二的流程是：

1. 第 1 次：给评委分加一次随机噪声 → 用模型重新求解 → 得到一整套观众投票估计，记作 $v^{(1)}$
2. 第 2 次：再换一组随机噪声 → 再求解 → 得到 $v^{(2)}$
3. …
4. 第 B 次：得到 $v^{(B)}$

对每一个「选手 + 周」，你就有 B 个观众投票估计值：$v^{(1)}, v^{(2)}, \ldots, v^{(B)}$。

然后用这 B 个数算：

* 均值 $\bar{v} = \frac{1}{B}\sum_b v^{(b)}$
* 方差 $\mathrm{Var}(v) = \frac{1}{B-1}\sum_b (v^{(b)}-\bar{v})^2$
* 95% 置信区间：这 B 个数的 2.5% 分位数 和 97.5% 分位数

所以：B 就是“我们一共做多少次‘加噪 + 重解’”，用来得到每个选手每周的 B 个估计，再算方差和置信区间。

## 为什么要设定 B？

* B 太小（比如 3、5）：

只有很少几个样本，算出来的方差、分位数会很不稳定，随机性大，确定性指标不可靠。

* B 太大（比如 100、200）：

每次都要重新跑一整季的优化，总时间 ≈ 单次耗时 × B × 季节数，计算会非常慢。

所以要在稳定度和计算时间之间折中，在运行时手动设定 B：

* 想快点看结果、做调试：用较小的 B（如 10、15）
* 做正式分析、写报告：用更大的 B（如 30、50），让方差和置信区间更稳定

脚本里用 --B 就是为了让你按需要调节这个次数，而不是写死一个数。



### 5.5 运行方式

```bash
# 默认：读 fan_vote_estimates_entropy_smooth_100.csv，两种方法都跑，B=15，σ=0.01
python fan_vote_certainty_analysis.py

# 仅方法一
python fan_vote_certainty_analysis.py --no-method2

# 仅方法二
python fan_vote_certainty_analysis.py --no-method1

# 指定 Bootstrap 次数与噪声标准差
python fan_vote_certainty_analysis.py --B 20 --sigma 0.02
```

---

## 平均平滑度 (avg_smoothness)

定义：衡量同一选手在相邻周之间投票变化的剧烈程度

$$
\text{smoothness}i = \frac{1}{T-1} \sum{t=2}^{T} (v_{i,t} - v_{i,t-1})^2
$$

作用：

| 值   | 含义                                         |
| ---- | -------------------------------------------- |
| 越小 | 选手的投票在各周之间越稳定，人气变化平缓     |
| 越大 | 投票波动剧烈，可能不符合"粉丝基础稳定"的假设 |

例如：

* λ=1.0 时平均平滑度 = 0.0141
* λ=10.0 时平均平滑度 = 0.0118（更平滑）

这说明 λ 越大，模型越强调时间连续性，结果越平滑。

---

## 平均边际余量 (avg_margin)

定义：淘汰者与最接近幸存者之间的总百分比差距

$$
\text{margin}k = \min{s \in \text{survived}} T_s - \max_{e \in \text{eliminated}} T_e
$$

作用：

| 值              | 含义                                     |
| --------------- | ---------------------------------------- |
| 越大            | 淘汰结果越"确定"，淘汰者与幸存者差距明显 |
| 接近 ε (0.001) | 淘汰结果很"勉强"，差距极小               |

例如：* λ=1.0 时平均边际余量 = 0.82%

* λ=10.0 时平均边际余量 = 1.83%

这说明 λ=10 的解有更大的"安全边际"，淘汰约束满足得更宽松。

---

## 总结

| 指标         | 衡量什么           | 越小越好？      |
| ------------ | ------------------ | --------------- |
| 平均平滑度   | 投票的时间稳定性   | ✓ 越小越平滑   |
| 平均边际余量 | 淘汰约束的宽松程度 | ✗ 越大越"确定" |

---

## 六、使用方法

### 6.1 运行最小方差版本

```bash
python fan_vote_estimation.py
```

输出：

- `fan_vote_estimates.csv`
- `fan_vote_estimates_with_confidence.csv`

### 6.2 运行平滑性版本

```bash
python fan_vote_estimation_smooth.py
```

输出：

- `fan_vote_estimates_smooth.csv`

### 6.3 运行最大熵+平滑性版本

```bash
python fan_vote_estimation_entropy_smooth.py
```

输出：

- `fan_vote_estimates_entropy_smooth.csv`

**调整 λ 参数：**

在代码中修改 `lambda_smooth` 参数：

```python
# 当前默认值（更强调连续性）
lambda_smooth = 10.0

# 平衡均匀性和连续性
lambda_smooth = 1.0

# 更强调均匀性
lambda_smooth = 0.1
```

### 6.4 依赖安装

```bash
pip install pandas numpy scipy openpyxl
# 可选（推荐）：
pip install cvxpy
```

---

## 七、模型局限性

### 7.1 共同局限性

1. **解不唯一性**：在约束较少时（如无淘汰周），存在多个满足约束的解
2. **数据依赖**：结果质量依赖于评委评分和淘汰结果的准确性
3. **无外部信息**：未利用社交媒体数据、搜索趋势等外部人气信号

### 7.2 最小方差方法局限性

- 假设粉丝投票均匀分布，可能低估"人气王"的实际投票
- 对早期周的估计可能偏保守

### 7.3 平滑性方法局限性

- 假设粉丝基础稳定，可能无法捕捉突发人气变化
- 如果选手人气确实在剧烈变化，估计会偏向平均
- 可能产生极端解（如某选手持续占据大部分投票）

### 7.4 最大熵+平滑性方法局限性

- 需要选择合适的 λ 参数，不同 λ 值会产生不同结果
- 计算复杂度较高（需要联合优化整个季度的数据）
- 熵项会使估计偏向均匀，可能低估真正的"人气王"

---

## 八、文件清单

| 文件名                                        | 类型 | 说明                                  |
| --------------------------------------------- | ---- | ------------------------------------- |
| `fan_vote_estimation.py`                    | 代码 | 最小方差正则化模型                    |
| `fan_vote_estimation_smooth.py`             | 代码 | 平滑性正则化模型                      |
| `fan_vote_estimation_entropy_smooth.py`     | 代码 | **最大熵+平滑性联合正则化模型** |
| `fan_vote_estimates.csv`                    | 结果 | 最小方差版本基础结果                  |
| `fan_vote_estimates_with_confidence.csv`    | 结果 | 最小方差版本（含置信度）              |
| `fan_vote_estimates_smooth.csv`             | 结果 | 平滑性版本结果                        |
| `fan_vote_estimates_entropy_smooth.csv`     | 结果 | **最大熵+平滑性版本结果**       |
| `fan_vote_estimates_entropy_smooth_100.csv` | 结果 | λ=100 估计结果（供确定性分析输入）   |
| `fan_vote_certainty_analysis.py`            | 代码 | **问题一第二问：确定性分析**    |
| `certainty_method1_interval_summary.csv`    | 结果 | 确定性方法一（可行域区间）汇总        |
| `certainty_method2_bootstrap.csv`           | 结果 | 确定性方法二（Bootstrap）结果         |
| `certainty_combined.csv`                    | 结果 | 两种确定性结果合并                    |
| `观众投票估计数学模型.md`                   | 文档 | 数学模型详细推导                      |
| `观众投票估计模型使用说明.md`               | 文档 | 本文档                                |
| `requirements.txt`                          | 配置 | Python依赖列表                        |

---

## 九、总结

本项目提供了三种互补的观众投票估计方法：

| 方法                    | 目标函数                                         | 核心假设     | 适用场景       |
| ----------------------- | ------------------------------------------------ | ------------ | -------------- |
| **最小方差**      | $\min \sum v_i^2$                              | 投票均匀分布 | 保守基准估计   |
| **平滑性**        | $\min \sum (v_{t} - v_{t-1})^2$                | 人气稳定变化 | 分析争议性选手 |
| **最大熵+平滑性** | $\max H(v) - \lambda \sum (v_{t} - v_{t-1})^2$ | 均匀且连续   | 综合分析       |

三种方法都保证100%的约束满足率（淘汰者总分 < 幸存者总分），但对粉丝投票分布有不同的先验假设：

1. **最小方差方法**：提供保守、均匀的估计，适合作为基准
2. **平滑性方法**：更好地刻画选手的稳定人气基础，适合分析争议性案例
3. **最大熵+平滑性方法**：综合考虑均匀性和连续性，避免极端解，通过 λ 参数可灵活调节两者权衡

在实际分析中，建议：

- 先运行最大熵+平滑性方法作为主要结果
- 对比其他两种方法的结果，检验假设的敏感性
- 结合多种方法的结果，获得更全面的理解
