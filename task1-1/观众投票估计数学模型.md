# 观众投票估计数学模型

## 一、问题背景

在Dancing with the Stars（DWTS）节目中，每周选手的去留由评委评分和观众投票共同决定。然而，观众投票数据是保密的，只有最终的淘汰结果是已知的。

本模型的目标是：**基于已知的评委评分和淘汰结果，反向估计每位选手每周的观众投票百分比**。

### 适用范围
- **第3-27季**：使用百分比方法合并评委分数和观众投票
- 总百分比 = 评委评分百分比 + 观众投票百分比
- 总百分比最低的选手被淘汰

---

## 二、符号定义

| 符号 | 含义 |
|------|------|
| $n$ | 本周参赛选手数量 |
| $v_i$ | 选手 $i$ 的观众投票百分比（待估计） |
| $j_i$ | 选手 $i$ 的评委评分百分比（已知） |
| $T_i$ | 选手 $i$ 的总百分比 |
| $E$ | 被淘汰选手的集合 |
| $S$ | 幸存选手的集合 |
| $\epsilon$ | 严格不等式的松弛量（取0.001） |

---

## 三、数学模型

### 3.1 决策变量

$$v_i \in [0, 1], \quad i = 1, 2, ..., n$$

表示选手 $i$ 获得的观众投票占总投票的百分比。

### 3.2 总百分比计算

选手 $i$ 的总百分比定义为：

$$T_i = j_i + v_i$$

其中：
- $j_i = \frac{\text{选手}i\text{的评委总分}}{\sum_{k=1}^{n}\text{选手}k\text{的评委总分}}$

### 3.3 约束条件

#### 约束1：归一化约束

所有选手的观众投票百分比之和为1：

$$\sum_{i=1}^{n} v_i = 1$$

#### 约束2：非负性约束

投票百分比不能为负：

$$v_i \geq 0, \quad \forall i \in \{1, 2, ..., n\}$$

#### 约束3：淘汰者约束（核心约束）

被淘汰者的总百分比必须低于所有幸存者的总百分比：

$$T_e < T_s, \quad \forall e \in E, \forall s \in S$$

即：

$$j_e + v_e < j_s + v_s$$

重新整理：

$$v_s - v_e > j_e - j_s$$

为处理严格不等式，引入松弛量 $\epsilon > 0$：

$$v_s - v_e \geq j_e - j_s + \epsilon$$

### 3.4 目标函数（最小方差正则化）

在缺乏外部人气信号的情况下，我们采用**最小方差原则**作为正则化手段：

> **核心思想**：在没有额外信息时，假设观众投票应相对均匀分布，避免对某些选手的人气做出过度乐观或悲观的估计。

最小化投票百分比与均匀分布的偏差：

$$\min \sum_{i=1}^{n} \left(v_i - \frac{1}{n}\right)^2$$

展开：

$$\min \sum_{i=1}^{n} v_i^2 - \frac{2}{n}\sum_{i=1}^{n}v_i + \frac{1}{n}$$

由于 $\sum v_i = 1$（归一化约束），上式等价于：

$$\min \sum_{i=1}^{n} v_i^2$$

---

## 四、完整优化问题

### 标准二次规划（QP）形式

$$
\begin{aligned}
\text{minimize} \quad & \mathbf{v}^T \mathbf{v} = \sum_{i=1}^{n} v_i^2 \\[10pt]
\text{subject to} \quad & \sum_{i=1}^{n} v_i = 1 & \text{(归一化)}\\[5pt]
& v_s - v_e \geq j_e - j_s + \epsilon, & \forall e \in E, \forall s \in S & \text{(淘汰约束)}\\[5pt]
& v_i \geq 0, & \forall i & \text{(非负性)}
\end{aligned}
$$

### 矩阵形式

设 $\mathbf{v} = [v_1, v_2, ..., v_n]^T$，问题可写为：

$$
\begin{aligned}
\text{minimize} \quad & \frac{1}{2}\mathbf{v}^T \mathbf{I} \mathbf{v} \\[10pt]
\text{subject to} \quad & \mathbf{A}_{eq} \mathbf{v} = \mathbf{b}_{eq} \\
& \mathbf{A}_{ineq} \mathbf{v} \geq \mathbf{b}_{ineq} \\
& \mathbf{v} \geq \mathbf{0}
\end{aligned}
$$

其中：
- $\mathbf{A}_{eq} = [1, 1, ..., 1]$，$\mathbf{b}_{eq} = 1$
- $\mathbf{A}_{ineq}$ 和 $\mathbf{b}_{ineq}$ 由淘汰约束构成

---

## 五、特殊情况处理

### 5.1 无淘汰周

当本周没有选手被淘汰时：
- 仅保留归一化约束和非负约束
- 优化结果趋向均匀分布：$v_i = \frac{1}{n}$

### 5.2 多人淘汰周

当本周淘汰多位选手时：
- 所有淘汰者的总百分比均应低于所有幸存者
- 约束数量为 $|E| \times |S|$

### 5.3 决赛周

决赛周需要确定最终排名（冠军、亚军、季军等）：

$$T_{\text{冠军}} > T_{\text{亚军}} > T_{\text{季军}} > ...$$

对应约束：

$$v_{r_k} - v_{r_{k+1}} \geq j_{r_{k+1}} - j_{r_k} + \epsilon$$

其中 $r_k$ 表示第 $k$ 名选手的索引。

### 5.4 约束不可行情况

当约束条件相互矛盾导致无可行解时（极少发生）：
- 放宽 $\epsilon$ 值
- 检查数据是否有错误
- 使用软约束（惩罚项）替代硬约束

---

## 六、模型性质分析

### 6.1 解的存在性

由于：
1. 可行域是凸多面体（线性约束定义）
2. 目标函数是严格凸二次函数
3. 可行域非空（通常情况下）

因此问题存在**唯一最优解**。

### 6.2 解的特征

最优解具有以下特征：
- 在满足所有约束的前提下，投票分布最接近均匀分布
- 淘汰者获得的投票刚好使其总分低于幸存者（约束紧）
- 幸存者之间的投票差异最小化

### 6.3 计算复杂度

- 变量数：$n$（选手数，通常3-13）
- 约束数：$1 + n + |E| \times |S|$
- 使用内点法求解，复杂度为 $O(n^3)$

---

## 七、置信度评估

### 7.1 约束松紧度分析

对于每个淘汰约束 $v_s - v_e \geq j_e - j_s + \epsilon$：
- **紧约束**（等号成立）：说明该约束对解起决定作用
- **松约束**（严格大于）：解有一定自由度

置信度指标：

$$\text{紧约束比例} = \frac{\text{紧约束数量}}{\text{总约束数量}}$$

比例越高，解的确定性越强。

### 7.2 灵敏度分析

对评委评分进行微扰 $\Delta j_i$，观察解的变化 $\Delta v_i$：

$$\text{灵敏度} = \frac{|\Delta v_i|}{|\Delta j_i|}$$

灵敏度越低，估计越稳定。

### 7.3 可行域大小

通过蒙特卡洛采样估计满足约束的解空间大小：
- 可行域越小，解的不确定性越低
- 可行域越大，多种投票分布都能解释观察到的淘汰结果

---

## 八、算法实现

### 8.1 使用 CVXPY 求解

```python
import cvxpy as cp
import numpy as np

def estimate_fan_votes(judge_percents, eliminated_indices):
    """
    估计观众投票百分比
    
    Args:
        judge_percents: 各选手评委评分百分比 (numpy数组)
        eliminated_indices: 被淘汰选手的索引列表
    
    Returns:
        fan_vote_percents: 估计的观众投票百分比
    """
    n = len(judge_percents)
    epsilon = 0.001
    
    # 决策变量
    v = cp.Variable(n)
    
    # 目标函数：最小化二次范数
    objective = cp.Minimize(cp.sum_squares(v))
    
    # 约束条件
    constraints = [
        cp.sum(v) == 1,  # 归一化
        v >= 0,          # 非负
    ]
    
    # 淘汰约束
    survived = [i for i in range(n) if i not in eliminated_indices]
    for e in eliminated_indices:
        for s in survived:
            constraints.append(
                v[s] - v[e] >= judge_percents[e] - judge_percents[s] + epsilon
            )
    
    # 求解
    prob = cp.Problem(objective, constraints)
    prob.solve()
    
    return v.value
```

### 8.2 数值示例

**输入数据（Season 5, Week 9）：**

| 选手 | 评委总分 | 评委百分比 $j_i$ |
|------|---------|-----------------|
| Jennie Garth | 29 | 0.248 |
| Marie Osmond | 28 | 0.239 |
| Mel B | 30 | 0.256 |
| Helio Castroneves | 30 | 0.256 |

淘汰者：Jennie Garth

**求解结果：**

| 选手 | 评委% | 观众% | 总% |
|------|-------|-------|-----|
| Jennie Garth | 24.8% | 11.0% | 35.8% |
| Marie Osmond | 23.9% | 37.0% | 60.9% |
| Mel B | 25.6% | 32.0% | 57.6% |
| Helio Castroneves | 25.6% | 20.0% | 45.6% |

Jennie Garth 的总百分比最低，与实际淘汰结果一致。

---

## 九、模型验证

### 9.1 一致性检验

对于每周的估计结果，验证：

$$\max_{e \in E} T_e < \min_{s \in S} T_s$$

即所有淘汰者的总百分比应低于所有幸存者。

### 9.2 历史数据回测

使用第3-27季的历史数据：
1. 对每周应用模型估计观众投票
2. 计算估计结果与实际淘汰结果的一致率
3. 目标：一致率应达到100%（模型设计保证）

### 9.3 交叉验证

对于有争议的选手（如Bobby Bones、Bristol Palin）：
- 分析其估计的观众投票是否异常高
- 与评委评分形成对比
- 验证模型能否解释"争议性"结果

---

## 十、模型局限性

1. **解不唯一性**：在约束较少时，可能存在多个满足约束的解
2. **先验假设**：最小方差假设可能不完全符合实际
3. **数据质量**：依赖准确的评委评分和淘汰结果记录
4. **极端情况**：当评委评分差异极大时，约束可能无法满足

---

## 十一、扩展方向

1. **引入历史信息**：利用选手在前几周的表现作为先验
2. **考虑人气指标**：引入社交媒体数据、搜索趋势等外部信号
3. **贝叶斯方法**：将点估计扩展为概率分布估计
4. **时间序列模型**：建模选手人气的动态变化

---

## 附录：符号速查表

| 符号 | 类型 | 含义 |
|------|------|------|
| $n$ | 标量 | 选手数量 |
| $v_i$ | 变量 | 选手i的观众投票百分比 |
| $j_i$ | 参数 | 选手i的评委评分百分比 |
| $T_i$ | 表达式 | 选手i的总百分比 = $j_i + v_i$ |
| $E$ | 集合 | 淘汰选手集合 |
| $S$ | 集合 | 幸存选手集合 |
| $\epsilon$ | 参数 | 松弛量（默认0.001） |
